CREATE TABLE profesor (
   profesor VARCHAR2(3),
   nombre VARCHAR2(50),
   PRIMARY KEY (profesor));

CREATE TABLE curso (
   curso VARCHAR2(6),
   nombre VARCHAR2(30),
   profesor VARCHAR2(3),
   PRIMARY KEY (curso),
   FOREIGN KEY (profesor) REFERENCES profesor (profesor));

CREATE TABLE alumno (
   alumno VARCHAR2(8),
   nombre VARCHAR2(50),
   promedio NUMBER(2),
   PRIMARY KEY (alumno));

CREATE TABLE nota (
   curso VARCHAR2(6),
   alumno VARCHAR2(8),
   tipo VARCHAR2(1), -- ‘1’: Examen.
                    -- ‘2’: Práctica. 
                    -- ‘3’: Trabajo Práctico.
   numeval NUMBER(1), -- Si tipo ‘1’, Examen 1, Examen 2.
                -- Si tipo ‘2’, Práctica 1, Práctica 2, etc. 
                -- Si tipo ‘3’, Trabajo Práctico.
   nota NUMBER(2),
   PRIMARY KEY (curso, alumno, tipo, numeval),
   FOREIGN KEY (curso) REFERENCES curso (curso),
   FOREIGN KEY (alumno) REFERENCES alumno (alumno));

INSERT INTO profesor (
   profesor, nombre )
VALUES (
   'p01', 'Alberto Campos');

INSERT INTO profesor (
   profesor, nombre )
VALUES (
   'p02', 'Roberto Rodríguez');

INSERT INTO profesor (
   profesor, nombre )
VALUES (
   'p03', 'Regina Pérez');

INSERT INTO profesor (
   profesor, nombre )
VALUES (
   'p04', 'Patricia Prado');

INSERT INTO curso (
   curso, nombre, profesor )
VALUES (
   'ADM301', 'Fundamentos de administración', 'p01');

INSERT INTO curso (
   curso, nombre, profesor )
VALUES (
   'ADM322', 'Métodos cuantitativos', 'p02');

INSERT INTO curso (
   curso, nombre, profesor )
VALUES (
   'CON231', 'Contabilidad 1', 'p03');

INSERT INTO curso (
   curso, nombre, profesor )
VALUES (
   'DER251', 'Derecho empresarial', 'p04');

INSERT INTO curso (
   curso, nombre, profesor )
VALUES (
   'ECO325', 'Análisis económico', 'p01');

   
INSERT INTO ALUMNO VALUES ('20056901','Enrique','0');
INSERT INTO ALUMNO VALUES ('20056902','Sofía','0');
INSERT INTO ALUMNO VALUES ('20056903','Carlos','0');
INSERT INTO ALUMNO VALUES ('20056904','Alberto','0');
INSERT INTO ALUMNO VALUES ('20056905','Patricia','0');
INSERT INTO ALUMNO VALUES ('20056906','Diana','0');
INSERT INTO ALUMNO VALUES ('20056907','Luis','0');
INSERT INTO ALUMNO VALUES ('20056908','Felipe','0');
INSERT INTO ALUMNO VALUES ('20056909','Rosana','0');
INSERT INTO ALUMNO VALUES ('20056910','Fanny','0');

INSERT INTO NOTA VALUES ('ADM301','20056901','1',1,16);
INSERT INTO NOTA VALUES ('ADM301','20056901','1',2,18);
INSERT INTO NOTA VALUES ('ADM301','20056901','2',1,15);
INSERT INTO NOTA VALUES ('ADM301','20056901','2',2,13);
INSERT INTO NOTA VALUES ('ADM301','20056901','2',3,19);
INSERT INTO NOTA VALUES ('ADM301','20056901','2',4,20);
INSERT INTO NOTA VALUES ('ADM322','20056901','1',1,11);
INSERT INTO NOTA VALUES ('ADM322','20056901','1',2,10);
INSERT INTO NOTA VALUES ('ADM322','20056901','2',1,13);
INSERT INTO NOTA VALUES ('ADM322','20056901','2',2,11);
INSERT INTO NOTA VALUES ('ADM322','20056901','2',3,8);
INSERT INTO NOTA VALUES ('ADM322','20056901','2',4,16);
INSERT INTO NOTA VALUES ('CON231','20056901','1',1,17);
INSERT INTO NOTA VALUES ('CON231','20056901','1',2,20);
INSERT INTO NOTA VALUES ('CON231','20056901','2',1,14);
INSERT INTO NOTA VALUES ('CON231','20056901','2',2,12);
INSERT INTO NOTA VALUES ('CON231','20056901','2',3,18);
INSERT INTO NOTA VALUES ('CON231','20056901','2',4,19);
INSERT INTO NOTA VALUES ('DER251','20056901','1',1,13);
INSERT INTO NOTA VALUES ('DER251','20056901','1',2,9);
INSERT INTO NOTA VALUES ('DER251','20056901','2',1,13);
INSERT INTO NOTA VALUES ('DER251','20056901','2',2,7);
INSERT INTO NOTA VALUES ('DER251','20056901','2',3,8);
INSERT INTO NOTA VALUES ('DER251','20056901','2',4,11);
INSERT INTO NOTA VALUES ('ECO325','20056901','1',1,13);
INSERT INTO NOTA VALUES ('ECO325','20056901','1',2,15);
INSERT INTO NOTA VALUES ('ECO325','20056901','2',1,18);
INSERT INTO NOTA VALUES ('ECO325','20056901','2',2,16);
INSERT INTO NOTA VALUES ('ECO325','20056901','2',3,13);
INSERT INTO NOTA VALUES ('ECO325','20056901','2',4,14);
INSERT INTO NOTA VALUES ('ADM301','20056902','1',1,8);
INSERT INTO NOTA VALUES ('ADM301','20056902','1',2,18);
INSERT INTO NOTA VALUES ('ADM301','20056902','2',1,5);
INSERT INTO NOTA VALUES ('ADM301','20056902','2',2,3);
INSERT INTO NOTA VALUES ('ADM301','20056902','2',3,19);
INSERT INTO NOTA VALUES ('ADM301','20056902','2',4,0);
INSERT INTO NOTA VALUES ('ADM322','20056902','1',1,1);
INSERT INTO NOTA VALUES ('ADM322','20056902','1',2,0);
INSERT INTO NOTA VALUES ('ADM322','20056902','2',1,3);
INSERT INTO NOTA VALUES ('ADM322','20056902','2',2,11);
INSERT INTO NOTA VALUES ('ADM322','20056902','2',3,8);
INSERT INTO NOTA VALUES ('ADM322','20056902','2',4,6);
INSERT INTO NOTA VALUES ('CON231','20056902','1',1,7);
INSERT INTO NOTA VALUES ('CON231','20056902','1',2,10);
INSERT INTO NOTA VALUES ('CON231','20056902','2',1,4);
INSERT INTO NOTA VALUES ('CON231','20056902','2',2,2);
INSERT INTO NOTA VALUES ('CON231','20056902','2',3,8);
INSERT INTO NOTA VALUES ('CON231','20056902','2',4,19);
INSERT INTO NOTA VALUES ('DER251','20056902','1',1,3);
INSERT INTO NOTA VALUES ('DER251','20056902','1',2,9);
INSERT INTO NOTA VALUES ('DER251','20056902','2',1,3);
INSERT INTO NOTA VALUES ('DER251','20056902','2',2,17);
INSERT INTO NOTA VALUES ('DER251','20056902','2',3,8);
INSERT INTO NOTA VALUES ('DER251','20056902','2',4,1);
INSERT INTO NOTA VALUES ('ECO325','20056902','1',1,3);
INSERT INTO NOTA VALUES ('ECO325','20056902','1',2,15);
INSERT INTO NOTA VALUES ('ECO325','20056902','2',1,8);
INSERT INTO NOTA VALUES ('ECO325','20056902','2',2,6);
INSERT INTO NOTA VALUES ('ECO325','20056902','2',3,13);
INSERT INTO NOTA VALUES ('ECO325','20056902','2',4,4);
INSERT INTO NOTA VALUES ('DER251','20056903','1',1,12);
INSERT INTO NOTA VALUES ('DER251','20056903','1',2,13);
INSERT INTO NOTA VALUES ('DER251','20056903','2',1,15);
INSERT INTO NOTA VALUES ('DER251','20056903','2',2,11);
INSERT INTO NOTA VALUES ('DER251','20056903','2',3,18);
INSERT INTO NOTA VALUES ('DER251','20056903','2',4,16);
INSERT INTO NOTA VALUES ('ECO325','20056903','1',1,15);
INSERT INTO NOTA VALUES ('ECO325','20056903','1',2,11);
INSERT INTO NOTA VALUES ('ECO325','20056903','2',1,12);
INSERT INTO NOTA VALUES ('ECO325','20056903','2',2,9);
INSERT INTO NOTA VALUES ('ECO325','20056903','2',3,14);
INSERT INTO NOTA VALUES ('ECO325','20056903','2',4,7);
INSERT INTO NOTA VALUES ('ADM322','20056904','1',1,15);
INSERT INTO NOTA VALUES ('ADM322','20056904','1',2,14);
INSERT INTO NOTA VALUES ('ADM322','20056904','2',1,17);
INSERT INTO NOTA VALUES ('ADM322','20056904','2',2,16);
INSERT INTO NOTA VALUES ('ADM322','20056904','2',3,16);
INSERT INTO NOTA VALUES ('ADM322','20056904','2',4,19);
INSERT INTO NOTA VALUES ('DER251','20056904','1',1,15);
INSERT INTO NOTA VALUES ('DER251','20056904','1',2,14);
INSERT INTO NOTA VALUES ('DER251','20056904','2',1,13);
INSERT INTO NOTA VALUES ('DER251','20056904','2',2,12);
INSERT INTO NOTA VALUES ('DER251','20056904','2',3,14);
INSERT INTO NOTA VALUES ('DER251','20056904','2',4,15);
INSERT INTO NOTA VALUES ('ECO325','20056904','1',1,16);
INSERT INTO NOTA VALUES ('ECO325','20056904','1',2,16);
INSERT INTO NOTA VALUES ('ECO325','20056904','2',1,17);
INSERT INTO NOTA VALUES ('ECO325','20056904','2',2,12);
INSERT INTO NOTA VALUES ('ECO325','20056904','2',3,15);
INSERT INTO NOTA VALUES ('ECO325','20056904','2',4,19);
INSERT INTO NOTA VALUES ('ADM322','20056905','1',1,15);
INSERT INTO NOTA VALUES ('ADM322','20056905','1',2,18);
INSERT INTO NOTA VALUES ('ADM322','20056905','2',1,20);
INSERT INTO NOTA VALUES ('ADM322','20056905','2',2,20);
INSERT INTO NOTA VALUES ('ADM322','20056905','2',3,19);
INSERT INTO NOTA VALUES ('ADM322','20056905','2',4,12);
INSERT INTO NOTA VALUES ('CON231','20056905','1',1,16);
INSERT INTO NOTA VALUES ('CON231','20056905','1',2,17);
INSERT INTO NOTA VALUES ('CON231','20056905','2',1,18);
INSERT INTO NOTA VALUES ('CON231','20056905','2',2,16);
INSERT INTO NOTA VALUES ('CON231','20056905','2',3,15);
INSERT INTO NOTA VALUES ('CON231','20056905','2',4,14);
INSERT INTO NOTA VALUES ('ECO325','20056905','1',1,15);
INSERT INTO NOTA VALUES ('ECO325','20056905','1',2,17);
INSERT INTO NOTA VALUES ('ECO325','20056905','2',1,18);
INSERT INTO NOTA VALUES ('ECO325','20056905','2',2,20);
INSERT INTO NOTA VALUES ('ECO325','20056905','2',3,20);
INSERT INTO NOTA VALUES ('ECO325','20056905','2',4,18);
INSERT INTO NOTA VALUES ('ADM301','20056907','1',1,11);
INSERT INTO NOTA VALUES ('ADM301','20056907','1',2,10);
INSERT INTO NOTA VALUES ('ADM301','20056907','2',1,11);
INSERT INTO NOTA VALUES ('ADM301','20056907','2',2,9);
INSERT INTO NOTA VALUES ('ADM301','20056907','2',3,12);
INSERT INTO NOTA VALUES ('ADM301','20056907','2',4,13);
INSERT INTO NOTA VALUES ('ADM322','20056907','1',1,12);
INSERT INTO NOTA VALUES ('ADM322','20056907','1',2,13);
INSERT INTO NOTA VALUES ('ADM322','20056907','2',1,13);
INSERT INTO NOTA VALUES ('ADM322','20056907','2',2,12);
INSERT INTO NOTA VALUES ('ADM322','20056907','2',3,8);
INSERT INTO NOTA VALUES ('ADM322','20056907','2',4,12);
INSERT INTO NOTA VALUES ('CON231','20056907','1',1,11);
INSERT INTO NOTA VALUES ('CON231','20056907','1',2,12);
INSERT INTO NOTA VALUES ('CON231','20056907','2',1,10);
INSERT INTO NOTA VALUES ('CON231','20056907','2',2,9);
INSERT INTO NOTA VALUES ('CON231','20056907','2',3,8);
INSERT INTO NOTA VALUES ('CON231','20056907','2',4,15);
INSERT INTO NOTA VALUES ('DER251','20056907','1',1,8);
INSERT INTO NOTA VALUES ('DER251','20056907','1',2,7);
INSERT INTO NOTA VALUES ('DER251','20056907','2',1,14);
INSERT INTO NOTA VALUES ('DER251','20056907','2',2,13);
INSERT INTO NOTA VALUES ('DER251','20056907','2',3,18);
INSERT INTO NOTA VALUES ('DER251','20056907','2',4,20);
INSERT INTO NOTA VALUES ('ECO325','20056907','1',1,13);
INSERT INTO NOTA VALUES ('ECO325','20056907','1',2,14);
INSERT INTO NOTA VALUES ('ECO325','20056907','2',1,15);
INSERT INTO NOTA VALUES ('ECO325','20056907','2',2,16);
INSERT INTO NOTA VALUES ('ECO325','20056907','2',3,17);
INSERT INTO NOTA VALUES ('ECO325','20056907','2',4,11);
INSERT INTO NOTA VALUES ('ADM301','20056908','1',1,12);
INSERT INTO NOTA VALUES ('ADM301','20056908','1',2,12);
INSERT INTO NOTA VALUES ('ADM301','20056908','2',1,13);
INSERT INTO NOTA VALUES ('ADM301','20056908','2',2,11);
INSERT INTO NOTA VALUES ('ADM301','20056908','2',3,11);
INSERT INTO NOTA VALUES ('ADM301','20056908','2',4,13);
INSERT INTO NOTA VALUES ('ADM322','20056908','1',1,12);
INSERT INTO NOTA VALUES ('ADM322','20056908','1',2,10);
INSERT INTO NOTA VALUES ('ADM322','20056908','2',1,11);
INSERT INTO NOTA VALUES ('ADM322','20056908','2',2,13);
INSERT INTO NOTA VALUES ('ADM322','20056908','2',3,15);
INSERT INTO NOTA VALUES ('ADM322','20056908','2',4,12);
INSERT INTO NOTA VALUES ('CON231','20056908','1',1,9);
INSERT INTO NOTA VALUES ('CON231','20056908','1',2,13);
INSERT INTO NOTA VALUES ('CON231','20056908','2',1,14);
INSERT INTO NOTA VALUES ('CON231','20056908','2',2,10);
INSERT INTO NOTA VALUES ('CON231','20056908','2',3,16);
INSERT INTO NOTA VALUES ('CON231','20056908','2',4,17);

CREATE TABLE alumnocurso (
   curso VARCHAR2(6),
   alumno VARCHAR2(8),
   promedio NUMBER(2),
   PRIMARY KEY (curso, alumno),
   FOREIGN KEY (curso) REFERENCES curso (curso),
   FOREIGN KEY (alumno) REFERENCES alumno (alumno));

UPDATE nota
   SET tipo    = '3'
     , numeval = 1
 WHERE tipo    = '2'
   AND numeval = '3';
UPDATE nota
   SET tipo    = '1'
     , numeval = 3
 WHERE tipo    = '2'
   AND numeval = '4';


INSERT INTO alumnocurso (
   curso, alumno, promedio )
SELECT curso, alumno, SUM(nota) / 10
  FROM
  (
   SELECT curso, alumno, 1 x, nota
     FROM nota
    WHERE tipo = '2'
      AND numeval = 1
   UNION
   SELECT curso, alumno, 2 x, nota * 2 nota
     FROM nota
    WHERE tipo = '1'
      AND numeval = 1
   UNION
   SELECT curso, alumno, 3 x, nota * 2 nota
     FROM nota
    WHERE tipo = '2'
      AND numeval = 2
   UNION
   SELECT curso, alumno, 4 x, nota * 2 nota
     FROM nota
    WHERE tipo = '3'
      AND numeval = 1
   UNION
   SELECT curso, alumno, 5 x, nota * 3 nota
     FROM nota
    WHERE tipo = '1'
      AND numeval = 2
  ) nota
 GROUP BY curso, alumno; 

ALTER TABLE alumno ADD becado VARCHAR2(1) DEFAULT 'N';

create or replace PROCEDURE ACTUALIZABECADO (
   palumno IN VARCHAR2 )
IS
   vCount      NUMBER;
   vBecado     alumno.becado%TYPE;
BEGIN
   SELECT COUNT(1) INTO vCount
     FROM alumno a
    WHERE alumno = pAlumno
      AND EXISTS (
         SELECT '1' FROM alumnocurso b
          WHERE b.alumno = a.alumno )
      AND NOT EXISTS (
         SELECT '1' FROM alumnocurso b
          WHERE b.alumno = a.alumno
            AND b.promedio < 15 );
   IF vCount = 1
   THEN
      vBecado := 'S';
   ELSE
      vBecado := 'N';
   END IF;
   UPDATE alumno
      SET becado = vBecado
    WHERE alumno = pAlumno;
END ACTUALIZABECADO;
 